version: 2

build:
  docker:
    - image: circleci/node:10
  working_directory: ~/app
  steps:
    - checkout
    - run:
       name: Install dependencies
       command: |
         yarn install
    - run:
        name: Build static html file
        command: |
          yarn build
    - persist_to_workspace:
        root: ~/app
        paths:
          - public

deploy:
  docker:
    - image: circleci/node:10
  working_directory: ~/app
  steps:
    - checkout
    - attach_workspace:
        at: ~/app
    - run:
        name: Install and configure dependencies
        command: |
          npm install -g --silent gh-pages@2.0.1
          git config user.email "ci@kamontat.net"
          git config user.name "kamontat cibot"
    - run:
        name: Deploy docs to gh-pages branch
        command: gh-pages --dist public

workflows:
  version: 2
  build:
    jobs:
      - build:
          filters:
            branches:
              only: master
      - deploy:
          requires:
            - build
          filters:
            branches:
              only: master
